<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>
<canvas id="webgl"></canvas>
<script src="./webgl.js"></script>
<script>

  const canvas = document.getElementById('webgl');
  const w = canvas.innerWidth;
  const h = canvas.innerHeight;
  resizeCanvas(canvas);
  const gl = canvas.getContext('webgl');

  // 顶点着色器
  const vertexShaderSource = `
    precision mediump float;
    attribute vec2 a_Position;
    attribute vec4 a_Color;
    varying vec4 v_Color;
    void main() {
      v_Color = a_Color;
      gl_Position = vec4(a_Position, 0.0, 1.0);
    }
  `;

  // 片元着色器
  const fragmentShaderSource = `
    precision mediump float;
    varying vec4 v_Color;
    void main() {
      gl_FragColor = v_Color;
    }
  `;

  webglInit(gl, vertexShaderSource, fragmentShaderSource);

  initBuffers(gl, gl.program);

  function initBuffers(gl, program) {
    const verticesColors = new Float32Array([
      0.0, 0.5, 1.0, 0.0, 0.0,
      -0.5, -0.5, 0.0, 1.0, 0.0,
      0.5, -0.5, 0.0, 0.0, 1.0
    ]);

    const colorBuffer = gl.createBuffer();

    gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW);

    const FSIZE = verticesColors.BYTES_PER_ELEMENT;
    const a_Position = gl.getAttribLocation(program, 'a_Position');
    const a_Color = gl.getAttribLocation(program, 'a_Color');

    gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, FSIZE * 5, 0);
    gl.enableVertexAttribArray(a_Position);

    gl.vertexAttribPointer(a_Color, 2, gl.FLOAT, false, FSIZE * 5, FSIZE * 2);
    gl.enableVertexAttribArray(a_Color);

    render(gl, 3);
  }

    //设置canvas的大小
  function resizeCanvas(canvas, width, height) {
      if (canvas.width !== width) {
          canvas.width = width ? width : window.innerWidth;
      }
      if (canvas.height !== height) {
          canvas.height = height ? height : window.innerHeight;
      }
    }

  function coordTransform(x, y) {
    const { width, height } = canvas;
    // 将 canvas 的坐标值 转换为 [-1.0, 1.0]的范围。
    const posisionX = 2 * x / width - 1;
    // canvas的 Y 轴坐标方向和 设备坐标系的相反。
    const positionY = -(2 * y / height - 1);
    return [posisionX, positionY];
  }

  function render(gl, n) {
    gl.clearColor(0.0, 0.0, 0.0, 1.0);
    gl.clear(gl.COLOR_BUFFER_BIT);
    gl.drawArrays(gl.TRIANGLES, 0, n);
  }

</script>
</body>
</html>